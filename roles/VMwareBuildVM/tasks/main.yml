---
# tasks file for BuildVM
- name: Obtain Credentials
  include_role:
    name: GetVaultCreds
  vars:
    includecred:
      - netbox
      - vcenter

# - name: Show me the contents
#   debug:
#     msg: "{{ netbox_cred }}"

- name: Get VM Info from Netbox
  netbox.netbox.netbox_virtual_machine:
    netbox_url: "{{ netbox_cred.url }}"
    netbox_token: "{{ netbox_cred.token }}"
    data:
      name: "{{ ServerName }}"
    state: present
    validate_certs: no